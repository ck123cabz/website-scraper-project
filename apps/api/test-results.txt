
> @website-scraper/api@0.1.0 test
> jest

PASS src/jobs/__tests__/export.service-t057.spec.ts
(node:21017) PromiseRejectionHandledWarning: Promise rejection was handled asynchronously (rejection id: 48)
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL src/queue/__tests__/retry-logic.spec.ts (6.095 s)
  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Retry Behavior with Timing Verification ‚Ä∫ should retry after 4 seconds on third transient failure

    ETIMEDOUT

      332 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'))
      333 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'))
    > 334 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'));
          |                                ^
      335 |
      336 |       const promise = retryWithBackoff(mockFn, 3);
      337 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:334:32)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Retry Behavior with Timing Verification ‚Ä∫ should retry after 4 seconds on third transient failure

    ETIMEDOUT

      332 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'))
      333 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'))
    > 334 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'));
          |                                ^
      335 |
      336 |       const promise = retryWithBackoff(mockFn, 3);
      337 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:334:32)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Retry Behavior with Timing Verification ‚Ä∫ should NOT attempt a 4th retry after 3 failures

    ETIMEDOUT

      346 |
      347 |     it('should NOT attempt a 4th retry after 3 failures', async () => {
    > 348 |       const mockFn = jest.fn().mockRejectedValue(new Error('ETIMEDOUT'));
          |                                                  ^
      349 |
      350 |       const promise = retryWithBackoff(mockFn, 3);
      351 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:348:50)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Retry Behavior with Timing Verification ‚Ä∫ should NOT attempt a 4th retry after 3 failures

    ETIMEDOUT

      346 |
      347 |     it('should NOT attempt a 4th retry after 3 failures', async () => {
    > 348 |       const mockFn = jest.fn().mockRejectedValue(new Error('ETIMEDOUT'));
          |                                                  ^
      349 |
      350 |       const promise = retryWithBackoff(mockFn, 3);
      351 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:348:50)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on timeout error

    timeout

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on timeout error

    timeout

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on ETIMEDOUT error

    ETIMEDOUT

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on ETIMEDOUT error

    ETIMEDOUT

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on ECONNRESET error

    ECONNRESET

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on ECONNRESET error

    ECONNRESET

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on 429 rate limit

    429

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on 429 rate limit

    429

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on 503 service unavailable

    503

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on 503 service unavailable

    503

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should track retry_count incrementing from 1 to 3

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should track retry_count incrementing from 1 to 3

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should set status to "failed" after 3rd attempt

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should set status to "failed" after 3rd attempt

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should store last_error with context (URL, error type)

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should store last_error with context (URL, error type)

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should store last_retry_at timestamp for each retry

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should store last_retry_at timestamp for each retry

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should include all retry delays in processing_time_ms

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 7000
    Received:    3000

      822 |       expect(finalWrite).toBeDefined();
      823 |       // Processing time should include all delays (1s + 2s + 4s = 7s)
    > 824 |       expect(finalWrite.processing_time_ms).toBeGreaterThanOrEqual(7000);
          |                                             ^
      825 |     });
      826 |   });
      827 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:824:45)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should include all retry delays in processing_time_ms

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should include all retry delays in processing_time_ms

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Job Status After Permanent Failure ‚Ä∫ should increment failed_urls_delta counter

    Request timeout after 30000ms for https://example.com/fail

      842 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      843 |         try {
    > 844 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      845 |         } catch (error) {
      846 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      847 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:844:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Job Status After Permanent Failure ‚Ä∫ should increment failed_urls_delta counter

    Request timeout after 30000ms for https://example.com/fail

      842 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      843 |         try {
    > 844 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      845 |         } catch (error) {
      846 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      847 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:844:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Job Status After Permanent Failure ‚Ä∫ should move job out of queue (update job status)

    Request timeout after 30000ms for https://example.com/fail

      842 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      843 |         try {
    > 844 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      845 |         } catch (error) {
      846 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      847 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:844:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Job Status After Permanent Failure ‚Ä∫ should move job out of queue (update job status)

    Request timeout after 30000ms for https://example.com/fail

      842 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      843 |         try {
    > 844 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      845 |         } catch (error) {
      846 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      847 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:844:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Error Message Sanitization ‚Ä∫ should truncate error messages longer than 200 characters

    AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

      946 |         for (let attempt = 0; attempt < 3; attempt++) {
      947 |           try {
    > 948 |             throw new Error(longError);
          |                   ^
      949 |           } catch (error) {
      950 |             const errorMessage = error instanceof Error ? error.message : 'Unknown';
      951 |             const isLastAttempt = attempt === 2;

      at processWithLongError (src/queue/__tests__/retry-logic.spec.ts:948:19)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Error Message Sanitization ‚Ä∫ should truncate error messages longer than 200 characters

    AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

      946 |         for (let attempt = 0; attempt < 3; attempt++) {
      947 |           try {
    > 948 |             throw new Error(longError);
          |                   ^
      949 |           } catch (error) {
      950 |             const errorMessage = error instanceof Error ? error.message : 'Unknown';
      951 |             const isLastAttempt = attempt === 2;

      at processWithLongError (src/queue/__tests__/retry-logic.spec.ts:948:19)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Error Message Sanitization ‚Ä∫ should preserve error context in truncated messages

    Request timeout after 30000ms for https://example.com/timeout

      1007 |         for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1008 |           try {
    > 1009 |             throw new Error(`Request timeout after 30000ms for ${url}`);
           |                   ^
      1010 |           } catch (error) {
      1011 |             const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1012 |             const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1009:19)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Error Message Sanitization ‚Ä∫ should preserve error context in truncated messages

    Request timeout after 30000ms for https://example.com/timeout

      1007 |         for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1008 |           try {
    > 1009 |             throw new Error(`Request timeout after 30000ms for ${url}`);
           |                   ^
      1010 |           } catch (error) {
      1011 |             const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1012 |             const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1009:19)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ No Retry After Max Attempts ‚Ä∫ should NOT attempt a 4th retry after 3 failures

    Request timeout after 30000ms for https://example.com/max-retries

      1064 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1065 |         try {
    > 1066 |           throw new Error(`Request timeout after 30000ms for ${url}`);
           |                 ^
      1067 |         } catch (error) {
      1068 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1069 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1066:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ No Retry After Max Attempts ‚Ä∫ should NOT attempt a 4th retry after 3 failures

    Request timeout after 30000ms for https://example.com/max-retries

      1064 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1065 |         try {
    > 1066 |           throw new Error(`Request timeout after 30000ms for ${url}`);
           |                 ^
      1067 |         } catch (error) {
      1068 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1069 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1066:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ No Retry After Max Attempts ‚Ä∫ should throw final error after 3rd attempt

    Request timeout after 30000ms for https://example.com/final-error

      1064 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1065 |         try {
    > 1066 |           throw new Error(`Request timeout after 30000ms for ${url}`);
           |                 ^
      1067 |         } catch (error) {
      1068 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1069 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1066:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ No Retry After Max Attempts ‚Ä∫ should throw final error after 3rd attempt

    Request timeout after 30000ms for https://example.com/final-error

      1064 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1065 |         try {
    > 1066 |           throw new Error(`Request timeout after 30000ms for ${url}`);
           |                 ^
      1067 |         } catch (error) {
      1068 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1069 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1066:17)

[31m[Nest] 21017  - [39m11/13/2025, 7:09:45 PM [31m  ERROR[39m [38;5;3m[QueueService] [39m[31mFailed to pause job job-123: Database error[39m
[31m[Nest] 21017  - [39m11/13/2025, 7:09:45 PM [31m  ERROR[39m [38;5;3m[QueueService] [39m[31mFailed to resume job job-123: Database error[39m
PASS src/queue/__tests__/queue.service.spec.ts
FAIL src/common/decorators/__tests__/perf-monitor.decorator.spec.ts (8.459 s)
  ‚óè PerfMonitor Decorator ‚Ä∫ Async method monitoring ‚Ä∫ should log completion for fast methods

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      60 |       expect(result).toBe('fast');
      61 |       // Verify logger.log was called (not warn or error)
    > 62 |       expect(loggerInstance.log).toHaveBeenCalled();
         |                                  ^
      63 |     });
      64 |
      65 |     it('should log warning for slow methods', async () => {

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:62:34)

  ‚óè PerfMonitor Decorator ‚Ä∫ Async method monitoring ‚Ä∫ should log warning for slow methods

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      69 |       expect(result).toBe('slow');
      70 |       // Verify logger.warn was called
    > 71 |       expect(loggerInstance.warn).toHaveBeenCalled();
         |                                   ^
      72 |     });
      73 |
      74 |     it('should log error for very slow methods', async () => {

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:71:35)

  ‚óè PerfMonitor Decorator ‚Ä∫ Async method monitoring ‚Ä∫ should log error for very slow methods

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      78 |       expect(result).toBe('very-slow');
      79 |       // Verify logger.error was called
    > 80 |       expect(loggerInstance.error).toHaveBeenCalled();
         |                                    ^
      81 |     });
      82 |
      83 |     it('should log error on method failure', async () => {

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:80:36)

  ‚óè PerfMonitor Decorator ‚Ä∫ Async method monitoring ‚Ä∫ should log error on method failure

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      86 |       await expect(service.errorMethod()).rejects.toThrow('Test error');
      87 |       // Verify logger.error was called for the failure
    > 88 |       expect(loggerInstance.error).toHaveBeenCalled();
         |                                    ^
      89 |     });
      90 |   });
      91 |

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:88:36)

  ‚óè PerfMonitor Decorator ‚Ä∫ Default thresholds ‚Ä∫ should use default thresholds (warn: 5000ms, error: 30000ms)

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      105 |       expect(result).toBe('default');
      106 |       // Should log completion (not warn or error) since 10ms < 5000ms
    > 107 |       expect(loggerInstance.log).toHaveBeenCalled();
          |                                  ^
      108 |     });
      109 |   });
      110 | });

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:107:34)

FAIL src/queue/__tests__/layer3-processor.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/llm.service.ts[0m:[93m4[0m:[93m52[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer3Results'. Did you mean 'Layer3Rules'?

    [7m4[0m import type { LlmProvider, ClassificationResponse, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                                                   ~~~~~~~~~~~~~[0m

PASS src/jobs/__tests__/export.service-streaming.spec.ts (8.829 s)
[31m[Nest] 21020  - [39m11/13/2025, 7:09:47 PM [31m  ERROR[39m [38;5;3m[ExportService] [39m[31mExport processing error: Job not found: 550e8400-e29b-41d4-a716-446655440099[39m
Error: Job not found: 550e8400-e29b-41d4-a716-446655440099
    at ExportService.processStreamExport (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/services/export.service.ts:117:15)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
[31m[Nest] 21020  - [39m11/13/2025, 7:09:47 PM [31m  ERROR[39m [38;5;3m[ExportService] [39m[31mExport stream error: Job not found: 550e8400-e29b-41d4-a716-446655440099[39m
Error: Job not found: 550e8400-e29b-41d4-a716-446655440099
    at ExportService.processStreamExport (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/services/export.service.ts:117:15)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
PASS src/jobs/__tests__/export.service-basic.spec.ts
[31m[Nest] 21023  - [39m11/13/2025, 7:09:48 PM [31m  ERROR[39m [38;5;3m[ScraperService] [39m[31mFailed to fetch URL: https://example.com - timeout[39m
[31m[Nest] 21023  - [39m11/13/2025, 7:09:48 PM [31m  ERROR[39m [38;5;3m[ScraperService] [39m[31mFailed to fetch URL: https://example.com - Connection reset[39m
PASS src/scraper/__tests__/scraper.service.spec.ts
FAIL src/jobs/__tests__/jobs.controller.queue-status.spec.ts (9.756 s)
  ‚óè Console

    console.error
      [JobsController] Error fetching queue status: Error: Database connection failed
          at Object.<anonymous> (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/__tests__/jobs.controller.queue-status.spec.ts:518:9)
          at Promise.finally.completed (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-runner/build/testWorker.js:497:12)

      566 |       }
      567 |
    > 568 |       console.error('[JobsController] Error fetching queue status:', error);
          |               ^
      569 |       throw new InternalServerErrorException('Failed to retrieve queue status. Please try again.');
      570 |     }
      571 |   }

      at JobsController.getQueueStatus (src/jobs/jobs.controller.ts:568:15)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should return 200 with job list containing all required fields

    expected 404 "Not Found", got 200 "OK"

      268 |       await request(app.getHttpServer())
      269 |         .get('/jobs/queue/status')
    > 270 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      271 |
      272 |       // TODO: Once endpoint is implemented, verify:
      273 |       // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:270:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should return activeJobs array with correct field types

    expected 404 "Not Found", got 200 "OK"

      283 |       await request(app.getHttpServer())
      284 |         .get('/jobs/queue/status')
    > 285 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      286 |
      287 |       // TODO: Once endpoint is implemented, verify each field type:
      288 |       // - id: string (UUID format)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:285:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should return processing jobs with queuePosition and estimatedWaitTime as null

    expected 404 "Not Found", got 200 "OK"

      306 |       await request(app.getHttpServer())
      307 |         .get('/jobs/queue/status')
    > 308 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      309 |
      310 |       // TODO: Verify processing jobs have:
      311 |       // - queuePosition: null

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:308:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should return queued jobs with valid queuePosition and estimatedWaitTime

    expected 404 "Not Found", got 200 "OK"

      321 |       await request(app.getHttpServer())
      322 |         .get('/jobs/queue/status')
    > 323 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      324 |
      325 |       // TODO: Verify queued jobs have:
      326 |       // - queuePosition: number (1, 2, 3...)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:323:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should validate UUID format for job IDs

    expected 404 "Not Found", got 200 "OK"

      335 |       await request(app.getHttpServer())
      336 |         .get('/jobs/queue/status')
    > 337 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      338 |
      339 |       // TODO: Verify all job IDs match UUID regex:
      340 |       // /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:337:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 2: Completed Jobs Section ‚Ä∫ should include completedJobs array when includeCompleted=true

    expected 404 "Not Found", got 200 "OK"

      355 |       await request(app.getHttpServer())
      356 |         .get('/jobs/queue/status?includeCompleted=true')
    > 357 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      358 |
      359 |       // TODO: Verify:
      360 |       // - jobsService.getCompletedJobs() was called

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:357:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 2: Completed Jobs Section ‚Ä∫ should not include completedJobs array when includeCompleted=false or omitted

    expected 404 "Not Found", got 200 "OK"

      370 |       await request(app.getHttpServer())
      371 |         .get('/jobs/queue/status')
    > 372 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      373 |
      374 |       // TODO: Verify:
      375 |       // - jobsService.getCompletedJobs() was NOT called

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:372:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 2: Completed Jobs Section ‚Ä∫ should return completedJobs with all required fields

    expected 404 "Not Found", got 200 "OK"

      385 |       await request(app.getHttpServer())
      386 |         .get('/jobs/queue/status?includeCompleted=true')
    > 387 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      388 |
      389 |       // TODO: Verify each completed job has:
      390 |       // - id: string (UUID)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:387:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 3: Filtering & Pagination ‚Ä∫ should limit active jobs to specified limit

    expected 404 "Not Found", got 200 "OK"

      413 |       await request(app.getHttpServer())
      414 |         .get('/jobs/queue/status?limit=2')
    > 415 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      416 |
      417 |       // TODO: Verify:
      418 |       // - jobsService.getActiveJobs() called with limit=2

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:415:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 3: Filtering & Pagination ‚Ä∫ should skip jobs based on offset parameter

    expected 404 "Not Found", got 200 "OK"

      431 |       await request(app.getHttpServer())
      432 |         .get('/jobs/queue/status?offset=2')
    > 433 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      434 |
      435 |       // TODO: Verify:
      436 |       // - jobsService.getActiveJobs() called with offset=2

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:433:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 3: Filtering & Pagination ‚Ä∫ should maintain correct order (oldest processing first)

    expected 404 "Not Found", got 200 "OK"

      452 |       await request(app.getHttpServer())
      453 |         .get('/jobs/queue/status')
    > 454 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      455 |
      456 |       // TODO: Verify job order in response matches expected order
      457 |     });

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:454:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 3: Filtering & Pagination ‚Ä∫ should ignore unknown query parameters

    expected 404 "Not Found", got 200 "OK"

      464 |       await request(app.getHttpServer())
      465 |         .get('/jobs/queue/status?unknownParam=value&anotherParam=123')
    > 466 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      467 |
      468 |       // TODO: Verify:
      469 |       // - Request succeeds (unknown params ignored)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:466:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 4: Error Handling ‚Ä∫ should return 400 for invalid limit (not a number)

    expected 404 "Not Found", got 400 "Bad Request"

      481 |       await request(app.getHttpServer())
      482 |         .get('/jobs/queue/status?limit=invalid')
    > 483 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      484 |
      485 |       // TODO: Once endpoint is implemented, verify:
      486 |       // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:483:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 4: Error Handling ‚Ä∫ should return 400 for invalid offset (not a number)

    expected 404 "Not Found", got 400 "Bad Request"

      492 |       await request(app.getHttpServer())
      493 |         .get('/jobs/queue/status?offset=invalid')
    > 494 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      495 |
      496 |       // TODO: Once endpoint is implemented, verify:
      497 |       // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:494:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 4: Error Handling ‚Ä∫ should return empty array if no active jobs

    expected 404 "Not Found", got 200 "OK"

      506 |       await request(app.getHttpServer())
      507 |         .get('/jobs/queue/status')
    > 508 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      509 |
      510 |       // TODO: Verify:
      511 |       // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:508:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 4: Error Handling ‚Ä∫ should return appropriate error if database unreachable

    expected 404 "Not Found", got 500 "Internal Server Error"

      522 |       await request(app.getHttpServer())
      523 |         .get('/jobs/queue/status')
    > 524 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      525 |
      526 |       // TODO: Once endpoint is implemented, verify:
      527 |       // - Status: 500 Internal Server Error

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:524:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 5: Real-Time Accuracy ‚Ä∫ should calculate progress accurately within 5% margin

    expected 404 "Not Found", got 200 "OK"

      562 |       await request(app.getHttpServer())
      563 |         .get('/jobs/queue/status')
    > 564 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      565 |
      566 |       // TODO: Verify for each job:
      567 |       // - progress = (completedCount / urlCount) * 100

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:564:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 5: Real-Time Accuracy ‚Ä∫ should ensure layerBreakdown sums to URL count for completed jobs

    expected 404 "Not Found", got 200 "OK"

      586 |       await request(app.getHttpServer())
      587 |         .get('/jobs/queue/status')
    > 588 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      589 |
      590 |       // TODO: Verify:
      591 |       // - layer1 + layer2 + layer3 = completedCount

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:588:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 5: Real-Time Accuracy ‚Ä∫ should return zero layer breakdown for jobs with no completed URLs

    expected 404 "Not Found", got 200 "OK"

      601 |       await request(app.getHttpServer())
      602 |         .get('/jobs/queue/status')
    > 603 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      604 |
      605 |       // TODO: Verify all queued jobs have:
      606 |       // - layerBreakdown.layer1 = 0

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:603:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 5: Real-Time Accuracy ‚Ä∫ should maintain sequential queue positions (1, 2, 3...)

    expected 404 "Not Found", got 200 "OK"

      617 |       await request(app.getHttpServer())
      618 |         .get('/jobs/queue/status')
    > 619 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      620 |
      621 |       // TODO: Verify queue positions are:
      622 |       // - Sequential integers starting at 1

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:619:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Integration Tests ‚Ä∫ should handle mixed active and queued jobs correctly

    expected 404 "Not Found", got 200 "OK"

      638 |       await request(app.getHttpServer())
      639 |         .get('/jobs/queue/status')
    > 640 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      641 |
      642 |       // TODO: Verify:
      643 |       // - Processing jobs have null queuePosition/estimatedWaitTime

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:640:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Integration Tests ‚Ä∫ should handle limit and offset together

    expected 404 "Not Found", got 200 "OK"

      657 |       await request(app.getHttpServer())
      658 |         .get('/jobs/queue/status?limit=2&offset=1')
    > 659 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      660 |
      661 |       // TODO: Verify:
      662 |       // - Returns 2 jobs starting from index 1

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:659:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Integration Tests ‚Ä∫ should handle includeCompleted with pagination

    expected 404 "Not Found", got 200 "OK"

      676 |       await request(app.getHttpServer())
      677 |         .get('/jobs/queue/status?includeCompleted=true&limit=2&offset=1')
    > 678 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      679 |
      680 |       // TODO: Verify:
      681 |       // - Pagination applies only to activeJobs

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:678:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Integration Tests ‚Ä∫ should handle empty active jobs with completed jobs

    expected 404 "Not Found", got 200 "OK"

      692 |       await request(app.getHttpServer())
      693 |         .get('/jobs/queue/status?includeCompleted=true')
    > 694 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      695 |
      696 |       // TODO: Verify:
      697 |       // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:694:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Service Method Verification ‚Ä∫ should call jobsService.getActiveJobs with correct parameters

    expected 404 "Not Found", got 200 "OK"

      713 |       await request(app.getHttpServer())
      714 |         .get('/jobs/queue/status?limit=10&offset=5')
    > 715 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      716 |
      717 |       // TODO: Verify jobsService.getActiveJobs called with:
      718 |       // - limit: 10

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:715:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Service Method Verification ‚Ä∫ should call jobsService.getCompletedJobs only when includeCompleted=true

    expected 404 "Not Found", got 200 "OK"

      728 |       await request(app.getHttpServer())
      729 |         .get('/jobs/queue/status')
    > 730 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      731 |
      732 |       // TODO: Verify getCompletedJobs was NOT called
      733 |

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:730:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Service Method Verification ‚Ä∫ should not call calculateProgress separately (assume calculated in getActiveJobs)

    expected 404 "Not Found", got 200 "OK"

      747 |       await request(app.getHttpServer())
      748 |         .get('/jobs/queue/status')
    > 749 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      750 |
      751 |       // TODO: Verify:
      752 |       // - calculateProgress method NOT called directly by controller

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:749:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

[31m[Nest] 21017  - [39m11/13/2025, 7:09:49 PM [31m  ERROR[39m [38;5;3m[ExportService] [39m[31mExport processing error: Job not found: 123e4567-e89b-12d3-a456-426614174001[39m
Error: Job not found: 123e4567-e89b-12d3-a456-426614174001
    at ExportService.processStreamExport (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/services/export.service.ts:117:15)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
[31m[Nest] 21017  - [39m11/13/2025, 7:09:49 PM [31m  ERROR[39m [38;5;3m[ExportService] [39m[31mExport stream error: Job not found: 123e4567-e89b-12d3-a456-426614174001[39m
Error: Job not found: 123e4567-e89b-12d3-a456-426614174001
    at ExportService.processStreamExport (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/services/export.service.ts:117:15)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
[31m[Nest] 21017  - [39m11/13/2025, 7:09:49 PM [31m  ERROR[39m [38;5;3m[ExportService] [39m[31mError fetching batch at page 1: Database connection error[39m
[31m[Nest] 21017  - [39m11/13/2025, 7:09:49 PM [31m  ERROR[39m [38;5;3m[ExportService] [39m[31mExport processing error: Database connection error[39m
Error: Database connection error
    at Object.<anonymous> (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/services/__tests__/export.service.spec.ts:515:51)
    at Promise.finally.completed (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
    at _callCircusTest (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
    at /Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:849:7
    at _runTestsForDescribeBlock (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
    at _runTestsForDescribeBlock (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
    at _runTestsForDescribeBlock (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
    at run (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
    at runAndTransformResultsToJestFormat (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
    at jestAdapter (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-runner/build/testWorker.js:275:16)
    at runTest (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-runner/build/testWorker.js:343:7)
    at Object.worker (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-runner/build/testWorker.js:497:12)
[31m[Nest] 21017  - [39m11/13/2025, 7:09:49 PM [31m  ERROR[39m [38;5;3m[ExportService] [39m[31mExport stream error: Database connection error[39m
Error: Database connection error
    at Object.<anonymous> (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/services/__tests__/export.service.spec.ts:515:51)
    at Promise.finally.completed (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
    at _callCircusTest (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
    at /Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:849:7
    at _runTestsForDescribeBlock (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
    at _runTestsForDescribeBlock (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
    at _runTestsForDescribeBlock (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
    at run (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
    at runAndTransformResultsToJestFormat (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
    at jestAdapter (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-runner/build/testWorker.js:275:16)
    at runTest (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-runner/build/testWorker.js:343:7)
    at Object.worker (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/node_modules/jest-runner/build/testWorker.js:497:12)
PASS src/jobs/services/__tests__/export.service.spec.ts
FAIL src/jobs/services/__tests__/layer2-integration.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/__tests__/jobs.controller.spec.ts (10.238 s)
  ‚óè Console

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

    console.error
      [JobsController] Error exporting results: TypeError: Cannot read properties of undefined (reading 'pipe')
          at JobsController.exportJobResults (/Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api/src/jobs/jobs.controller.ts:410:14)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      429 |
      430 |       // Log and throw generic error
    > 431 |       console.error('[JobsController] Error exporting results:', error);
          |               ^
      432 |       throw new InternalServerErrorException('Failed to export results. Please try again.');
      433 |     }
      434 |   }

      at JobsController.exportJobResults (src/jobs/jobs.controller.ts:431:15)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 1: Export with format=complete (default) ‚Ä∫ should return 200 OK with CSV content-type and 48 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      468 |           .post('/jobs/' + jobId + '/export')
      469 |           .send({ format: 'complete' })
    > 470 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      471 |
      472 |         // TODO: Once endpoint is implemented, verify:
      473 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:470:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 1: Export with format=complete (default) ‚Ä∫ should use format=complete as default when format not specified

    expected 404 "Not Found", got 500 "Internal Server Error"

      483 |           .post('/jobs/' + jobId + '/export')
      484 |           .send({})
    > 485 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      486 |
      487 |         // TODO: Once endpoint is implemented, verify default format is 'complete'
      488 |       });

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:485:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 1: Export with format=complete (default) ‚Ä∫ should include proper response headers

    expected 404 "Not Found", got 500 "Internal Server Error"

      493 |           .post('/jobs/' + jobId + '/export')
      494 |           .send({ format: 'complete' })
    > 495 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      496 |
      497 |         // TODO: Once endpoint is implemented, verify headers:
      498 |         // - Content-Type: text/csv; charset=utf-8

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:495:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 2: Export with format=summary ‚Ä∫ should return 200 OK with CSV containing 7 columns only

    expected 404 "Not Found", got 500 "Internal Server Error"

      508 |           .post('/jobs/' + jobId + '/export')
      509 |           .send({ format: 'summary' })
    > 510 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      511 |
      512 |         // TODO: Once endpoint is implemented, verify:
      513 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:510:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 2: Export with format=summary ‚Ä∫ should include proper filename for summary format

    expected 404 "Not Found", got 500 "Internal Server Error"

      520 |           .post('/jobs/' + jobId + '/export')
      521 |           .send({ format: 'summary' })
    > 522 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      523 |
      524 |         // TODO: Once endpoint is implemented, verify:
      525 |         // - Content-Disposition: attachment; filename="job-{jobId}-summary.csv"

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:522:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with filter=approved, layer=passed_all

    expected 404 "Not Found", got 500 "Internal Server Error"

      537 |             layer: 'passed_all',
      538 |           })
    > 539 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      540 |
      541 |         // TODO: Once endpoint is implemented, verify:
      542 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:539:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with filter=rejected, confidence=low

    expected 404 "Not Found", got 500 "Internal Server Error"

      554 |             confidence: 'low',
      555 |           })
    > 556 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      557 |
      558 |         // TODO: Once endpoint is implemented, verify:
      559 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:556:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with layer=layer1 filter only

    expected 404 "Not Found", got 500 "Internal Server Error"

      569 |             layer: 'layer1',
      570 |           })
    > 571 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      572 |
      573 |         // TODO: Once endpoint is implemented, verify:
      574 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:571:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with confidence=high filter only

    expected 404 "Not Found", got 500 "Internal Server Error"

      584 |             confidence: 'high',
      585 |           })
    > 586 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      587 |
      588 |         // TODO: Once endpoint is implemented, verify:
      589 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:586:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with all filters combined

    expected 404 "Not Found", got 500 "Internal Server Error"

      601 |             confidence: 'high',
      602 |           })
    > 603 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      604 |
      605 |         // TODO: Once endpoint is implemented, verify:
      606 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:603:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 4: Export with invalid format ‚Ä∫ should return 400 Bad Request for invalid format

    expected 404 "Not Found", got 500 "Internal Server Error"

      615 |           .post('/jobs/' + jobId + '/export')
      616 |           .send({ format: 'invalid_format' })
    > 617 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      618 |
      619 |         // TODO: Once endpoint is implemented, verify:
      620 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:617:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 4: Export with invalid format ‚Ä∫ should return 400 Bad Request for empty format string

    expected 404 "Not Found", got 500 "Internal Server Error"

      628 |           .post('/jobs/' + jobId + '/export')
      629 |           .send({ format: '' })
    > 630 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      631 |
      632 |         // TODO: Once endpoint is implemented, verify:
      633 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:630:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 5: Export for non-existent job ‚Ä∫ should return 404 Not Found for non-existent job ID

    expected 404 "Not Found", got 500 "Internal Server Error"

      643 |           .post('/jobs/' + nonExistentJobId + '/export')
      644 |           .send({ format: 'complete' })
    > 645 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      646 |
      647 |         // TODO: Once endpoint is implemented, verify:
      648 |         // - Status: 404 Not Found

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:645:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 6: Export with invalid UUID format ‚Ä∫ should return 400 Bad Request for invalid UUID format

    expected 404 "Not Found", got 400 "Bad Request"

      657 |           .post('/jobs/invalid-uuid-format/export')
      658 |           .send({ format: 'complete' })
    > 659 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      660 |
      661 |         // TODO: Once endpoint is implemented, verify:
      662 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:659:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 6: Export with invalid UUID format ‚Ä∫ should return 400 Bad Request for malformed UUID

    expected 404 "Not Found", got 400 "Bad Request"

      669 |           .post('/jobs/123-456-789/export')
      670 |           .send({ format: 'complete' })
    > 671 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      672 |
      673 |         // TODO: Once endpoint is implemented, verify:
      674 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:671:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=complete and return 48 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=summary and return 7 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=layer1 and return 15 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=layer2 and return 20 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=layer3 and return 25 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should handle filter=all (no filtering)

    expected 404 "Not Found", got 500 "Internal Server Error"

      710 |             filter: 'all',
      711 |           })
    > 712 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      713 |
      714 |         // TODO: Once endpoint is implemented, verify:
      715 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:712:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should handle layer=all (no layer filtering)

    expected 404 "Not Found", got 500 "Internal Server Error"

      725 |             layer: 'all',
      726 |           })
    > 727 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      728 |
      729 |         // TODO: Once endpoint is implemented, verify:
      730 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:727:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should handle confidence=all (no confidence filtering)

    expected 404 "Not Found", got 500 "Internal Server Error"

      740 |             confidence: 'all',
      741 |           })
    > 742 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      743 |
      744 |         // TODO: Once endpoint is implemented, verify:
      745 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:742:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should handle multiple valid filters simultaneously

    expected 404 "Not Found", got 500 "Internal Server Error"

      757 |             confidence: 'medium',
      758 |           })
    > 759 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      760 |
      761 |         // TODO: Once endpoint is implemented, verify:
      762 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:759:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should return 400 for invalid filter value

    expected 404 "Not Found", got 500 "Internal Server Error"

      775 |             filter: 'invalid_filter',
      776 |           })
    > 777 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      778 |
      779 |         // TODO: Once endpoint is implemented, verify:
      780 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:777:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should return 400 for invalid layer value

    expected 404 "Not Found", got 500 "Internal Server Error"

      790 |             layer: 'invalid_layer',
      791 |           })
    > 792 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      793 |
      794 |         // TODO: Once endpoint is implemented, verify:
      795 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:792:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should return 400 for invalid confidence value

    expected 404 "Not Found", got 500 "Internal Server Error"

      805 |             confidence: 'invalid_confidence',
      806 |           })
    > 807 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      808 |
      809 |         // TODO: Once endpoint is implemented, verify:
      810 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:807:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should handle empty result set gracefully

    expected 404 "Not Found", got 500 "Internal Server Error"

      819 |           .post('/jobs/' + jobId + '/export')
      820 |           .send({ format: 'complete' })
    > 821 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      822 |
      823 |         // TODO: Once endpoint is implemented, verify:
      824 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:821:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should handle large result sets without timeout

    expected 404 "Not Found", got 500 "Internal Server Error"

      831 |           .post('/jobs/' + jobId + '/export')
      832 |           .send({ format: 'complete' })
    > 833 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      834 |
      835 |         // TODO: Once endpoint is implemented, verify:
      836 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:833:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should handle NULL factor values in export

    expected 404 "Not Found", got 500 "Internal Server Error"

      843 |           .post('/jobs/' + jobId + '/export')
      844 |           .send({ format: 'complete' })
    > 845 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      846 |
      847 |         // TODO: Once endpoint is implemented, verify:
      848 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:845:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should validate request body schema

    expected 404 "Not Found", got 500 "Internal Server Error"

      858 |             unknown_field: 'should_be_rejected',
      859 |           })
    > 860 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      861 |
      862 |         // TODO: Once endpoint is implemented, verify:
      863 |         // - Status: 400 Bad Request (if forbidNonWhitelisted is true)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:860:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should handle concurrent export requests

    expected 404 "Not Found", got 500 "Internal Server Error"

      874 |
      875 |         await Promise.all(
    > 876 |           requests.map(req => req.expect(HttpStatus.NOT_FOUND))
          |                                   ^
      877 |         );
      878 |
      879 |         // TODO: Once endpoint is implemented, verify:

      at src/jobs/__tests__/jobs.controller.spec.ts:876:35
          at Array.map (<anonymous>)
      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:876:20)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at ../../node_modules/supertest/lib/test.js:156:7
      at Test.fn [as callback] (../../node_modules/superagent/src/node/index.js:904:3)
      at callback (../../node_modules/superagent/src/node/index.js:1183:18)
      at IncomingMessage.fn (../../node_modules/superagent/src/node/parsers/json.js:19:7)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Streaming and Performance Requirements ‚Ä∫ should use streaming response (not buffer entire file)

    expected 404 "Not Found", got 500 "Internal Server Error"

      889 |           .post('/jobs/' + jobId + '/export')
      890 |           .send({ format: 'complete' })
    > 891 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      892 |
      893 |         // TODO: Once endpoint is implemented, verify:
      894 |         // - Response uses streaming (check Transfer-Encoding or similar)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:891:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Streaming and Performance Requirements ‚Ä∫ should call ExportService.streamCSVExport()

    expected 404 "Not Found", got 500 "Internal Server Error"

      901 |           .post('/jobs/' + jobId + '/export')
      902 |           .send({ format: 'complete' })
    > 903 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      904 |
      905 |         // TODO: Once endpoint is implemented, verify:
      906 |         // - JobsController calls ExportService.streamCSVExport()

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:903:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Streaming and Performance Requirements ‚Ä∫ should complete export of 10k rows in < 5 seconds

    expected 404 "Not Found", got 500 "Internal Server Error"

      915 |           .post('/jobs/' + jobId + '/export')
      916 |           .send({ format: 'complete' })
    > 917 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      918 |
      919 |         const elapsedTime = Date.now() - startTime;
      920 |

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:917:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

FAIL src/queue/__tests__/layer-factors.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer1-domain-analysis.service.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m8[0m   Layer1Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

PASS src/jobs/__tests__/prefilter.service.spec.ts
  ‚óè Console

    console.log
      Average processing time: 0.00ms per URL

      at Object.<anonymous> (src/jobs/__tests__/prefilter.service.spec.ts:409:15)

FAIL src/jobs/services/__tests__/product-offering-detector.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

PASS src/settings/dto/__tests__/layer1-rules.dto.spec.ts
FAIL src/queue/__tests__/layer2-processor.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/services/__tests__/monetization-detector.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/__tests__/llm.service.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/llm.service.ts[0m:[93m4[0m:[93m52[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer3Results'. Did you mean 'Layer3Rules'?

    [7m4[0m import type { LlmProvider, ClassificationResponse, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                                                   ~~~~~~~~~~~~~[0m

FAIL src/jobs/__tests__/confidence-scoring.service.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/__tests__/confidence-scoring.service.spec.ts[0m:[93m54[0m:[93m5[0m - [91merror[0m[90m TS2353: [0mObject literal may only specify known properties, and 'queue_size_limit' does not exist in type 'ManualReviewSettings'.

    [7m54[0m     queue_size_limit: null,
    [7m  [0m [91m    ~~~~~~~~~~~~~~~~[0m

      [96m../../packages/shared/src/types/settings.ts[0m:[93m124[0m:[93m3[0m
        [7m124[0m   manual_review_settings: ManualReviewSettings;
        [7m   [0m [96m  ~~~~~~~~~~~~~~~~~~~~~~[0m
        The expected type comes from property 'manual_review_settings' which is declared here on type 'ClassificationSettings'

PASS src/settings/__tests__/queue-size-validation.spec.ts
PASS src/queue/utils/__tests__/error-classifier.spec.ts
FAIL src/jobs/services/__tests__/navigation-parser.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/services/__tests__/layout-analyzer.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

PASS src/settings/dto/__tests__/layer2-rules.dto.spec.ts
PASS src/settings/settings.service.spec.ts
FAIL src/queue/__tests__/layer1-processor.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer1-domain-analysis.service.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m8[0m   Layer1Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/services/__tests__/routing-activity-logs.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/__tests__/routing-activity-logs.spec.ts[0m:[93m2[0m:[93m43[0m - [91merror[0m[90m TS2307: [0mCannot find module '../manual-review-router.service' or its corresponding type declarations.

    [7m2[0m import { ManualReviewRouterService } from '../manual-review-router.service';
    [7m [0m [91m                                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/routing-activity-logs.spec.ts[0m:[93m5[0m:[93m15[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m              ~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/routing-activity-logs.spec.ts[0m:[93m5[0m:[93m30[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                             ~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/routing-activity-logs.spec.ts[0m:[93m5[0m:[93m45[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer3Results'. Did you mean 'Layer3Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                                            ~~~~~~~~~~~~~[0m

FAIL src/workers/__tests__/url-worker.processor.spec.ts
  ‚óè Test suite failed to run

    [96msrc/workers/__tests__/url-worker.processor.spec.ts[0m:[93m9[0m:[93m43[0m - [91merror[0m[90m TS2307: [0mCannot find module '../../jobs/services/manual-review-router.service' or its corresponding type declarations.

    [7m9[0m import { ManualReviewRouterService } from '../../jobs/services/manual-review-router.service';
    [7m [0m [91m                                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m

FAIL src/queue/__tests__/queue.service-process-url-integration.spec.ts
  ‚óè Test suite failed to run

    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m243[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: true; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: true; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m243[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m244[0m       passed: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m246[0m       processingTimeMs: 50,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m247[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m252[0m:[93m51[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ success: true; content: string; title: string; }' is not assignable to parameter of type 'ScraperResult | Promise<ScraperResult>'.
      Type '{ success: true; content: string; title: string; }' is missing the following properties from type 'ScraperResult': url, metaDescription

    [7m252[0m     mockScraperService.fetchUrl.mockResolvedValue({
    [7m   [0m [91m                                                  ~[0m
    [7m253[0m       success: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m255[0m       title: 'Enterprise Software Solution',
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m256[0m     });
    [7m   [0m [91m~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m262[0m:[93m7[0m - [91merror[0m[90m TS2740: [0mType '{}' is missing the following properties from type 'Layer2Signals': has_product_offering, product_confidence, detected_product_keywords, homepage_is_blog, and 10 more.

    [7m262[0m       signals: {},
    [7m   [0m [91m      ~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m272[0m:[93m7[0m - [91merror[0m[90m TS2322: [0mType '"openai"' is not assignable to type 'LlmProvider'.

    [7m272[0m       provider: 'openai',
    [7m   [0m [91m      ~~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m401[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: false; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: false; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m401[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m402[0m       passed: false,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m404[0m       processingTimeMs: 30,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m405[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m473[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: true; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: true; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m473[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m474[0m       passed: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m476[0m       processingTimeMs: 40,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m477[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m481[0m:[93m51[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ success: true; content: string; title: string; }' is not assignable to parameter of type 'ScraperResult | Promise<ScraperResult>'.
      Type '{ success: true; content: string; title: string; }' is missing the following properties from type 'ScraperResult': url, metaDescription

    [7m481[0m     mockScraperService.fetchUrl.mockResolvedValue({
    [7m   [0m [91m                                                  ~[0m
    [7m482[0m       success: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m484[0m       title: 'My Personal Blog',
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m485[0m     });
    [7m   [0m [91m~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m491[0m:[93m7[0m - [91merror[0m[90m TS2740: [0mType '{}' is missing the following properties from type 'Layer2Signals': has_product_offering, product_confidence, detected_product_keywords, homepage_is_blog, and 10 more.

    [7m491[0m       signals: {},
    [7m   [0m [91m      ~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m575[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: true; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: true; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m575[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m576[0m       passed: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m578[0m       processingTimeMs: 45,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m579[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m583[0m:[93m51[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ success: true; content: string; title: string; }' is not assignable to parameter of type 'ScraperResult | Promise<ScraperResult>'.
      Type '{ success: true; content: string; title: string; }' is missing the following properties from type 'ScraperResult': url, metaDescription

    [7m583[0m     mockScraperService.fetchUrl.mockResolvedValue({
    [7m   [0m [91m                                                  ~[0m
    [7m584[0m       success: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m586[0m       title: 'Generic Store',
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m587[0m     });
    [7m   [0m [91m~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m592[0m:[93m7[0m - [91merror[0m[90m TS2740: [0mType '{}' is missing the following properties from type 'Layer2Signals': has_product_offering, product_confidence, detected_product_keywords, homepage_is_blog, and 10 more.

    [7m592[0m       signals: {},
    [7m   [0m [91m      ~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m602[0m:[93m7[0m - [91merror[0m[90m TS2322: [0mType '"openai"' is not assignable to type 'LlmProvider'.

    [7m602[0m       provider: 'openai',
    [7m   [0m [91m      ~~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m657[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: true; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: true; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m657[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m658[0m       passed: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m660[0m       processingTimeMs: 40,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m661[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m681[0m:[93m51[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ success: true; content: string; title: string; }' is not assignable to parameter of type 'ScraperResult | Promise<ScraperResult>'.
      Type '{ success: true; content: string; title: string; }' is missing the following properties from type 'ScraperResult': url, metaDescription

    [7m681[0m     mockScraperService.fetchUrl.mockResolvedValue({
    [7m   [0m [91m                                                  ~[0m
    [7m682[0m       success: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m684[0m       title: 'Site Title',
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m685[0m     });
    [7m   [0m [91m~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m690[0m:[93m7[0m - [91merror[0m[90m TS2740: [0mType '{}' is missing the following properties from type 'Layer2Signals': has_product_offering, product_confidence, detected_product_keywords, homepage_is_blog, and 10 more.

    [7m690[0m       signals: {},
    [7m   [0m [91m      ~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m736[0m:[93m7[0m - [91merror[0m[90m TS2322: [0mType '"openai"' is not assignable to type 'LlmProvider'.

    [7m736[0m       provider: 'openai',
    [7m   [0m [91m      ~~~~~~~~[0m

PASS src/jobs/__tests__/export.service-t064-layer3.spec.ts
FAIL src/jobs/services/__tests__/confidence-routing-accuracy.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/__tests__/confidence-routing-accuracy.spec.ts[0m:[93m2[0m:[93m43[0m - [91merror[0m[90m TS2307: [0mCannot find module '../manual-review-router.service' or its corresponding type declarations.

    [7m2[0m import { ManualReviewRouterService } from '../manual-review-router.service';
    [7m [0m [91m                                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/confidence-routing-accuracy.spec.ts[0m:[93m5[0m:[93m15[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m              ~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/confidence-routing-accuracy.spec.ts[0m:[93m5[0m:[93m30[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                             ~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/confidence-routing-accuracy.spec.ts[0m:[93m5[0m:[93m45[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer3Results'. Did you mean 'Layer3Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                                            ~~~~~~~~~~~~~[0m

[31m[Nest] 21021  - [39m11/13/2025, 7:09:53 PM [31m  ERROR[39m [38;5;3m[SettingsController] [39m[31mFailed to fetch settings: Database connection failed[39m
[31m[Nest] 21021  - [39m11/13/2025, 7:09:53 PM [31m  ERROR[39m [38;5;3m[SettingsController] [39m[31mFailed to update settings: Invalid regex pattern[39m
[31m[Nest] 21021  - [39m11/13/2025, 7:09:53 PM [31m  ERROR[39m [38;5;3m[SettingsController] [39m[31mFailed to update settings: Failed to update settings: Database error[39m
[31m[Nest] 21021  - [39m11/13/2025, 7:09:53 PM [31m  ERROR[39m [38;5;3m[SettingsController] [39m[31mFailed to reset settings: Reset failed[39m
PASS src/settings/settings.controller.spec.ts
FAIL src/settings/__tests__/settings-integration.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer1-domain-analysis.service.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m8[0m   Layer1Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

PASS src/settings/__tests__/settings-validation.spec.ts
FAIL src/__tests__/integration/open-access.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer1-domain-analysis.service.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m8[0m   Layer1Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

Summary of all failing tests
FAIL src/queue/__tests__/retry-logic.spec.ts (6.095 s)
  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Retry Behavior with Timing Verification ‚Ä∫ should retry after 4 seconds on third transient failure

    ETIMEDOUT

      332 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'))
      333 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'))
    > 334 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'));
          |                                ^
      335 |
      336 |       const promise = retryWithBackoff(mockFn, 3);
      337 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:334:32)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Retry Behavior with Timing Verification ‚Ä∫ should retry after 4 seconds on third transient failure

    ETIMEDOUT

      332 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'))
      333 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'))
    > 334 |         .mockRejectedValueOnce(new Error('ETIMEDOUT'));
          |                                ^
      335 |
      336 |       const promise = retryWithBackoff(mockFn, 3);
      337 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:334:32)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Retry Behavior with Timing Verification ‚Ä∫ should NOT attempt a 4th retry after 3 failures

    ETIMEDOUT

      346 |
      347 |     it('should NOT attempt a 4th retry after 3 failures', async () => {
    > 348 |       const mockFn = jest.fn().mockRejectedValue(new Error('ETIMEDOUT'));
          |                                                  ^
      349 |
      350 |       const promise = retryWithBackoff(mockFn, 3);
      351 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:348:50)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Retry Behavior with Timing Verification ‚Ä∫ should NOT attempt a 4th retry after 3 failures

    ETIMEDOUT

      346 |
      347 |     it('should NOT attempt a 4th retry after 3 failures', async () => {
    > 348 |       const mockFn = jest.fn().mockRejectedValue(new Error('ETIMEDOUT'));
          |                                                  ^
      349 |
      350 |       const promise = retryWithBackoff(mockFn, 3);
      351 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:348:50)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on timeout error

    timeout

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on timeout error

    timeout

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on ETIMEDOUT error

    ETIMEDOUT

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on ETIMEDOUT error

    ETIMEDOUT

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on ECONNRESET error

    ECONNRESET

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on ECONNRESET error

    ECONNRESET

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on 429 rate limit

    429

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on 429 rate limit

    429

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on 503 service unavailable

    503

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Retry Logic with Exponential Backoff (T027) ‚Ä∫ Error Scenarios Matrix ‚Ä∫ should RETRY on 503 service unavailable

    503

      484 |     errorTestCases.forEach(({ error, shouldRetry, description }) => {
      485 |       it(`should ${shouldRetry ? 'RETRY' : 'NOT retry'} on ${description}`, async () => {
    > 486 |         const mockFn = jest.fn().mockRejectedValue(new Error(error));
          |                                                    ^
      487 |
      488 |         const retryWithBackoff = async <T>(
      489 |           fn: () => Promise<T>,

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:486:52)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should track retry_count incrementing from 1 to 3

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should track retry_count incrementing from 1 to 3

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should set status to "failed" after 3rd attempt

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should set status to "failed" after 3rd attempt

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should store last_error with context (URL, error type)

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should store last_error with context (URL, error type)

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should store last_retry_at timestamp for each retry

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should store last_retry_at timestamp for each retry

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should include all retry delays in processing_time_ms

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 7000
    Received:    3000

      822 |       expect(finalWrite).toBeDefined();
      823 |       // Processing time should include all delays (1s + 2s + 4s = 7s)
    > 824 |       expect(finalWrite.processing_time_ms).toBeGreaterThanOrEqual(7000);
          |                                             ^
      825 |     });
      826 |   });
      827 |

      at Object.<anonymous> (src/queue/__tests__/retry-logic.spec.ts:824:45)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should include all retry delays in processing_time_ms

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Failure Lifecycle Tracking ‚Ä∫ should include all retry delays in processing_time_ms

    Request timeout after 30000ms for https://example.com/timeout-url

      631 |         try {
      632 |           // Simulate URL fetch (will throw timeout error)
    > 633 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      634 |         } catch (error) {
      635 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      636 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:633:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Job Status After Permanent Failure ‚Ä∫ should increment failed_urls_delta counter

    Request timeout after 30000ms for https://example.com/fail

      842 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      843 |         try {
    > 844 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      845 |         } catch (error) {
      846 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      847 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:844:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Job Status After Permanent Failure ‚Ä∫ should increment failed_urls_delta counter

    Request timeout after 30000ms for https://example.com/fail

      842 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      843 |         try {
    > 844 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      845 |         } catch (error) {
      846 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      847 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:844:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Job Status After Permanent Failure ‚Ä∫ should move job out of queue (update job status)

    Request timeout after 30000ms for https://example.com/fail

      842 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      843 |         try {
    > 844 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      845 |         } catch (error) {
      846 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      847 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:844:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Job Status After Permanent Failure ‚Ä∫ should move job out of queue (update job status)

    Request timeout after 30000ms for https://example.com/fail

      842 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      843 |         try {
    > 844 |           throw new Error(`Request timeout after 30000ms for ${url}`);
          |                 ^
      845 |         } catch (error) {
      846 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      847 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:844:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Error Message Sanitization ‚Ä∫ should truncate error messages longer than 200 characters

    AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

      946 |         for (let attempt = 0; attempt < 3; attempt++) {
      947 |           try {
    > 948 |             throw new Error(longError);
          |                   ^
      949 |           } catch (error) {
      950 |             const errorMessage = error instanceof Error ? error.message : 'Unknown';
      951 |             const isLastAttempt = attempt === 2;

      at processWithLongError (src/queue/__tests__/retry-logic.spec.ts:948:19)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Error Message Sanitization ‚Ä∫ should truncate error messages longer than 200 characters

    AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

      946 |         for (let attempt = 0; attempt < 3; attempt++) {
      947 |           try {
    > 948 |             throw new Error(longError);
          |                   ^
      949 |           } catch (error) {
      950 |             const errorMessage = error instanceof Error ? error.message : 'Unknown';
      951 |             const isLastAttempt = attempt === 2;

      at processWithLongError (src/queue/__tests__/retry-logic.spec.ts:948:19)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Error Message Sanitization ‚Ä∫ should preserve error context in truncated messages

    Request timeout after 30000ms for https://example.com/timeout

      1007 |         for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1008 |           try {
    > 1009 |             throw new Error(`Request timeout after 30000ms for ${url}`);
           |                   ^
      1010 |           } catch (error) {
      1011 |             const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1012 |             const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1009:19)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ Error Message Sanitization ‚Ä∫ should preserve error context in truncated messages

    Request timeout after 30000ms for https://example.com/timeout

      1007 |         for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1008 |           try {
    > 1009 |             throw new Error(`Request timeout after 30000ms for ${url}`);
           |                   ^
      1010 |           } catch (error) {
      1011 |             const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1012 |             const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1009:19)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ No Retry After Max Attempts ‚Ä∫ should NOT attempt a 4th retry after 3 failures

    Request timeout after 30000ms for https://example.com/max-retries

      1064 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1065 |         try {
    > 1066 |           throw new Error(`Request timeout after 30000ms for ${url}`);
           |                 ^
      1067 |         } catch (error) {
      1068 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1069 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1066:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ No Retry After Max Attempts ‚Ä∫ should NOT attempt a 4th retry after 3 failures

    Request timeout after 30000ms for https://example.com/max-retries

      1064 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1065 |         try {
    > 1066 |           throw new Error(`Request timeout after 30000ms for ${url}`);
           |                 ^
      1067 |         } catch (error) {
      1068 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1069 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1066:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ No Retry After Max Attempts ‚Ä∫ should throw final error after 3rd attempt

    Request timeout after 30000ms for https://example.com/final-error

      1064 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1065 |         try {
    > 1066 |           throw new Error(`Request timeout after 30000ms for ${url}`);
           |                 ^
      1067 |         } catch (error) {
      1068 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1069 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1066:17)

  ‚óè Permanent Failure After 3 Retry Attempts (T028) ‚Ä∫ No Retry After Max Attempts ‚Ä∫ should throw final error after 3rd attempt

    Request timeout after 30000ms for https://example.com/final-error

      1064 |       for (let attempt = 0; attempt < maxAttempts; attempt++) {
      1065 |         try {
    > 1066 |           throw new Error(`Request timeout after 30000ms for ${url}`);
           |                 ^
      1067 |         } catch (error) {
      1068 |           const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      1069 |           const isLastAttempt = attempt === maxAttempts - 1;

      at processUrlWithRetryTracking (src/queue/__tests__/retry-logic.spec.ts:1066:17)

FAIL src/common/decorators/__tests__/perf-monitor.decorator.spec.ts (8.459 s)
  ‚óè PerfMonitor Decorator ‚Ä∫ Async method monitoring ‚Ä∫ should log completion for fast methods

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      60 |       expect(result).toBe('fast');
      61 |       // Verify logger.log was called (not warn or error)
    > 62 |       expect(loggerInstance.log).toHaveBeenCalled();
         |                                  ^
      63 |     });
      64 |
      65 |     it('should log warning for slow methods', async () => {

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:62:34)

  ‚óè PerfMonitor Decorator ‚Ä∫ Async method monitoring ‚Ä∫ should log warning for slow methods

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      69 |       expect(result).toBe('slow');
      70 |       // Verify logger.warn was called
    > 71 |       expect(loggerInstance.warn).toHaveBeenCalled();
         |                                   ^
      72 |     });
      73 |
      74 |     it('should log error for very slow methods', async () => {

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:71:35)

  ‚óè PerfMonitor Decorator ‚Ä∫ Async method monitoring ‚Ä∫ should log error for very slow methods

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      78 |       expect(result).toBe('very-slow');
      79 |       // Verify logger.error was called
    > 80 |       expect(loggerInstance.error).toHaveBeenCalled();
         |                                    ^
      81 |     });
      82 |
      83 |     it('should log error on method failure', async () => {

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:80:36)

  ‚óè PerfMonitor Decorator ‚Ä∫ Async method monitoring ‚Ä∫ should log error on method failure

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      86 |       await expect(service.errorMethod()).rejects.toThrow('Test error');
      87 |       // Verify logger.error was called for the failure
    > 88 |       expect(loggerInstance.error).toHaveBeenCalled();
         |                                    ^
      89 |     });
      90 |   });
      91 |

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:88:36)

  ‚óè PerfMonitor Decorator ‚Ä∫ Default thresholds ‚Ä∫ should use default thresholds (warn: 5000ms, error: 30000ms)

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      105 |       expect(result).toBe('default');
      106 |       // Should log completion (not warn or error) since 10ms < 5000ms
    > 107 |       expect(loggerInstance.log).toHaveBeenCalled();
          |                                  ^
      108 |     });
      109 |   });
      110 | });

      at Object.<anonymous> (src/common/decorators/__tests__/perf-monitor.decorator.spec.ts:107:34)

FAIL src/queue/__tests__/layer3-processor.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/llm.service.ts[0m:[93m4[0m:[93m52[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer3Results'. Did you mean 'Layer3Rules'?

    [7m4[0m import type { LlmProvider, ClassificationResponse, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                                                   ~~~~~~~~~~~~~[0m

FAIL src/jobs/__tests__/jobs.controller.queue-status.spec.ts (9.756 s)
  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should return 200 with job list containing all required fields

    expected 404 "Not Found", got 200 "OK"

      268 |       await request(app.getHttpServer())
      269 |         .get('/jobs/queue/status')
    > 270 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      271 |
      272 |       // TODO: Once endpoint is implemented, verify:
      273 |       // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:270:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should return activeJobs array with correct field types

    expected 404 "Not Found", got 200 "OK"

      283 |       await request(app.getHttpServer())
      284 |         .get('/jobs/queue/status')
    > 285 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      286 |
      287 |       // TODO: Once endpoint is implemented, verify each field type:
      288 |       // - id: string (UUID format)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:285:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should return processing jobs with queuePosition and estimatedWaitTime as null

    expected 404 "Not Found", got 200 "OK"

      306 |       await request(app.getHttpServer())
      307 |         .get('/jobs/queue/status')
    > 308 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      309 |
      310 |       // TODO: Verify processing jobs have:
      311 |       // - queuePosition: null

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:308:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should return queued jobs with valid queuePosition and estimatedWaitTime

    expected 404 "Not Found", got 200 "OK"

      321 |       await request(app.getHttpServer())
      322 |         .get('/jobs/queue/status')
    > 323 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      324 |
      325 |       // TODO: Verify queued jobs have:
      326 |       // - queuePosition: number (1, 2, 3...)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:323:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 1: Endpoint Response Contract ‚Ä∫ should validate UUID format for job IDs

    expected 404 "Not Found", got 200 "OK"

      335 |       await request(app.getHttpServer())
      336 |         .get('/jobs/queue/status')
    > 337 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      338 |
      339 |       // TODO: Verify all job IDs match UUID regex:
      340 |       // /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:337:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 2: Completed Jobs Section ‚Ä∫ should include completedJobs array when includeCompleted=true

    expected 404 "Not Found", got 200 "OK"

      355 |       await request(app.getHttpServer())
      356 |         .get('/jobs/queue/status?includeCompleted=true')
    > 357 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      358 |
      359 |       // TODO: Verify:
      360 |       // - jobsService.getCompletedJobs() was called

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:357:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 2: Completed Jobs Section ‚Ä∫ should not include completedJobs array when includeCompleted=false or omitted

    expected 404 "Not Found", got 200 "OK"

      370 |       await request(app.getHttpServer())
      371 |         .get('/jobs/queue/status')
    > 372 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      373 |
      374 |       // TODO: Verify:
      375 |       // - jobsService.getCompletedJobs() was NOT called

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:372:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 2: Completed Jobs Section ‚Ä∫ should return completedJobs with all required fields

    expected 404 "Not Found", got 200 "OK"

      385 |       await request(app.getHttpServer())
      386 |         .get('/jobs/queue/status?includeCompleted=true')
    > 387 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      388 |
      389 |       // TODO: Verify each completed job has:
      390 |       // - id: string (UUID)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:387:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 3: Filtering & Pagination ‚Ä∫ should limit active jobs to specified limit

    expected 404 "Not Found", got 200 "OK"

      413 |       await request(app.getHttpServer())
      414 |         .get('/jobs/queue/status?limit=2')
    > 415 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      416 |
      417 |       // TODO: Verify:
      418 |       // - jobsService.getActiveJobs() called with limit=2

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:415:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 3: Filtering & Pagination ‚Ä∫ should skip jobs based on offset parameter

    expected 404 "Not Found", got 200 "OK"

      431 |       await request(app.getHttpServer())
      432 |         .get('/jobs/queue/status?offset=2')
    > 433 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      434 |
      435 |       // TODO: Verify:
      436 |       // - jobsService.getActiveJobs() called with offset=2

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:433:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 3: Filtering & Pagination ‚Ä∫ should maintain correct order (oldest processing first)

    expected 404 "Not Found", got 200 "OK"

      452 |       await request(app.getHttpServer())
      453 |         .get('/jobs/queue/status')
    > 454 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      455 |
      456 |       // TODO: Verify job order in response matches expected order
      457 |     });

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:454:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 3: Filtering & Pagination ‚Ä∫ should ignore unknown query parameters

    expected 404 "Not Found", got 200 "OK"

      464 |       await request(app.getHttpServer())
      465 |         .get('/jobs/queue/status?unknownParam=value&anotherParam=123')
    > 466 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      467 |
      468 |       // TODO: Verify:
      469 |       // - Request succeeds (unknown params ignored)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:466:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 4: Error Handling ‚Ä∫ should return 400 for invalid limit (not a number)

    expected 404 "Not Found", got 400 "Bad Request"

      481 |       await request(app.getHttpServer())
      482 |         .get('/jobs/queue/status?limit=invalid')
    > 483 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      484 |
      485 |       // TODO: Once endpoint is implemented, verify:
      486 |       // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:483:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 4: Error Handling ‚Ä∫ should return 400 for invalid offset (not a number)

    expected 404 "Not Found", got 400 "Bad Request"

      492 |       await request(app.getHttpServer())
      493 |         .get('/jobs/queue/status?offset=invalid')
    > 494 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      495 |
      496 |       // TODO: Once endpoint is implemented, verify:
      497 |       // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:494:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 4: Error Handling ‚Ä∫ should return empty array if no active jobs

    expected 404 "Not Found", got 200 "OK"

      506 |       await request(app.getHttpServer())
      507 |         .get('/jobs/queue/status')
    > 508 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      509 |
      510 |       // TODO: Verify:
      511 |       // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:508:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 4: Error Handling ‚Ä∫ should return appropriate error if database unreachable

    expected 404 "Not Found", got 500 "Internal Server Error"

      522 |       await request(app.getHttpServer())
      523 |         .get('/jobs/queue/status')
    > 524 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      525 |
      526 |       // TODO: Once endpoint is implemented, verify:
      527 |       // - Status: 500 Internal Server Error

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:524:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 5: Real-Time Accuracy ‚Ä∫ should calculate progress accurately within 5% margin

    expected 404 "Not Found", got 200 "OK"

      562 |       await request(app.getHttpServer())
      563 |         .get('/jobs/queue/status')
    > 564 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      565 |
      566 |       // TODO: Verify for each job:
      567 |       // - progress = (completedCount / urlCount) * 100

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:564:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 5: Real-Time Accuracy ‚Ä∫ should ensure layerBreakdown sums to URL count for completed jobs

    expected 404 "Not Found", got 200 "OK"

      586 |       await request(app.getHttpServer())
      587 |         .get('/jobs/queue/status')
    > 588 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      589 |
      590 |       // TODO: Verify:
      591 |       // - layer1 + layer2 + layer3 = completedCount

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:588:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 5: Real-Time Accuracy ‚Ä∫ should return zero layer breakdown for jobs with no completed URLs

    expected 404 "Not Found", got 200 "OK"

      601 |       await request(app.getHttpServer())
      602 |         .get('/jobs/queue/status')
    > 603 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      604 |
      605 |       // TODO: Verify all queued jobs have:
      606 |       // - layerBreakdown.layer1 = 0

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:603:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Scenario 5: Real-Time Accuracy ‚Ä∫ should maintain sequential queue positions (1, 2, 3...)

    expected 404 "Not Found", got 200 "OK"

      617 |       await request(app.getHttpServer())
      618 |         .get('/jobs/queue/status')
    > 619 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      620 |
      621 |       // TODO: Verify queue positions are:
      622 |       // - Sequential integers starting at 1

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:619:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Integration Tests ‚Ä∫ should handle mixed active and queued jobs correctly

    expected 404 "Not Found", got 200 "OK"

      638 |       await request(app.getHttpServer())
      639 |         .get('/jobs/queue/status')
    > 640 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      641 |
      642 |       // TODO: Verify:
      643 |       // - Processing jobs have null queuePosition/estimatedWaitTime

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:640:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Integration Tests ‚Ä∫ should handle limit and offset together

    expected 404 "Not Found", got 200 "OK"

      657 |       await request(app.getHttpServer())
      658 |         .get('/jobs/queue/status?limit=2&offset=1')
    > 659 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      660 |
      661 |       // TODO: Verify:
      662 |       // - Returns 2 jobs starting from index 1

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:659:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Integration Tests ‚Ä∫ should handle includeCompleted with pagination

    expected 404 "Not Found", got 200 "OK"

      676 |       await request(app.getHttpServer())
      677 |         .get('/jobs/queue/status?includeCompleted=true&limit=2&offset=1')
    > 678 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      679 |
      680 |       // TODO: Verify:
      681 |       // - Pagination applies only to activeJobs

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:678:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Integration Tests ‚Ä∫ should handle empty active jobs with completed jobs

    expected 404 "Not Found", got 200 "OK"

      692 |       await request(app.getHttpServer())
      693 |         .get('/jobs/queue/status?includeCompleted=true')
    > 694 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      695 |
      696 |       // TODO: Verify:
      697 |       // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:694:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Service Method Verification ‚Ä∫ should call jobsService.getActiveJobs with correct parameters

    expected 404 "Not Found", got 200 "OK"

      713 |       await request(app.getHttpServer())
      714 |         .get('/jobs/queue/status?limit=10&offset=5')
    > 715 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      716 |
      717 |       // TODO: Verify jobsService.getActiveJobs called with:
      718 |       // - limit: 10

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:715:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Service Method Verification ‚Ä∫ should call jobsService.getCompletedJobs only when includeCompleted=true

    expected 404 "Not Found", got 200 "OK"

      728 |       await request(app.getHttpServer())
      729 |         .get('/jobs/queue/status')
    > 730 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      731 |
      732 |       // TODO: Verify getCompletedJobs was NOT called
      733 |

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:730:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - GET /jobs/queue/status (T072) ‚Ä∫ Service Method Verification ‚Ä∫ should not call calculateProgress separately (assume calculated in getActiveJobs)

    expected 404 "Not Found", got 200 "OK"

      747 |       await request(app.getHttpServer())
      748 |         .get('/jobs/queue/status')
    > 749 |         .expect(HttpStatus.NOT_FOUND);
          |          ^
      750 |
      751 |       // TODO: Verify:
      752 |       // - calculateProgress method NOT called directly by controller

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.queue-status.spec.ts:749:10)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

FAIL src/jobs/services/__tests__/layer2-integration.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/__tests__/jobs.controller.spec.ts (10.238 s)
  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 1: Export with format=complete (default) ‚Ä∫ should return 200 OK with CSV content-type and 48 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      468 |           .post('/jobs/' + jobId + '/export')
      469 |           .send({ format: 'complete' })
    > 470 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      471 |
      472 |         // TODO: Once endpoint is implemented, verify:
      473 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:470:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 1: Export with format=complete (default) ‚Ä∫ should use format=complete as default when format not specified

    expected 404 "Not Found", got 500 "Internal Server Error"

      483 |           .post('/jobs/' + jobId + '/export')
      484 |           .send({})
    > 485 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      486 |
      487 |         // TODO: Once endpoint is implemented, verify default format is 'complete'
      488 |       });

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:485:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 1: Export with format=complete (default) ‚Ä∫ should include proper response headers

    expected 404 "Not Found", got 500 "Internal Server Error"

      493 |           .post('/jobs/' + jobId + '/export')
      494 |           .send({ format: 'complete' })
    > 495 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      496 |
      497 |         // TODO: Once endpoint is implemented, verify headers:
      498 |         // - Content-Type: text/csv; charset=utf-8

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:495:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 2: Export with format=summary ‚Ä∫ should return 200 OK with CSV containing 7 columns only

    expected 404 "Not Found", got 500 "Internal Server Error"

      508 |           .post('/jobs/' + jobId + '/export')
      509 |           .send({ format: 'summary' })
    > 510 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      511 |
      512 |         // TODO: Once endpoint is implemented, verify:
      513 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:510:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 2: Export with format=summary ‚Ä∫ should include proper filename for summary format

    expected 404 "Not Found", got 500 "Internal Server Error"

      520 |           .post('/jobs/' + jobId + '/export')
      521 |           .send({ format: 'summary' })
    > 522 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      523 |
      524 |         // TODO: Once endpoint is implemented, verify:
      525 |         // - Content-Disposition: attachment; filename="job-{jobId}-summary.csv"

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:522:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with filter=approved, layer=passed_all

    expected 404 "Not Found", got 500 "Internal Server Error"

      537 |             layer: 'passed_all',
      538 |           })
    > 539 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      540 |
      541 |         // TODO: Once endpoint is implemented, verify:
      542 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:539:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with filter=rejected, confidence=low

    expected 404 "Not Found", got 500 "Internal Server Error"

      554 |             confidence: 'low',
      555 |           })
    > 556 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      557 |
      558 |         // TODO: Once endpoint is implemented, verify:
      559 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:556:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with layer=layer1 filter only

    expected 404 "Not Found", got 500 "Internal Server Error"

      569 |             layer: 'layer1',
      570 |           })
    > 571 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      572 |
      573 |         // TODO: Once endpoint is implemented, verify:
      574 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:571:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with confidence=high filter only

    expected 404 "Not Found", got 500 "Internal Server Error"

      584 |             confidence: 'high',
      585 |           })
    > 586 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      587 |
      588 |         // TODO: Once endpoint is implemented, verify:
      589 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:586:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 3: Export with filters applied ‚Ä∫ should export with all filters combined

    expected 404 "Not Found", got 500 "Internal Server Error"

      601 |             confidence: 'high',
      602 |           })
    > 603 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      604 |
      605 |         // TODO: Once endpoint is implemented, verify:
      606 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:603:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 4: Export with invalid format ‚Ä∫ should return 400 Bad Request for invalid format

    expected 404 "Not Found", got 500 "Internal Server Error"

      615 |           .post('/jobs/' + jobId + '/export')
      616 |           .send({ format: 'invalid_format' })
    > 617 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      618 |
      619 |         // TODO: Once endpoint is implemented, verify:
      620 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:617:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 4: Export with invalid format ‚Ä∫ should return 400 Bad Request for empty format string

    expected 404 "Not Found", got 500 "Internal Server Error"

      628 |           .post('/jobs/' + jobId + '/export')
      629 |           .send({ format: '' })
    > 630 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      631 |
      632 |         // TODO: Once endpoint is implemented, verify:
      633 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:630:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 5: Export for non-existent job ‚Ä∫ should return 404 Not Found for non-existent job ID

    expected 404 "Not Found", got 500 "Internal Server Error"

      643 |           .post('/jobs/' + nonExistentJobId + '/export')
      644 |           .send({ format: 'complete' })
    > 645 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      646 |
      647 |         // TODO: Once endpoint is implemented, verify:
      648 |         // - Status: 404 Not Found

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:645:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 6: Export with invalid UUID format ‚Ä∫ should return 400 Bad Request for invalid UUID format

    expected 404 "Not Found", got 400 "Bad Request"

      657 |           .post('/jobs/invalid-uuid-format/export')
      658 |           .send({ format: 'complete' })
    > 659 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      660 |
      661 |         // TODO: Once endpoint is implemented, verify:
      662 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:659:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 6: Export with invalid UUID format ‚Ä∫ should return 400 Bad Request for malformed UUID

    expected 404 "Not Found", got 400 "Bad Request"

      669 |           .post('/jobs/123-456-789/export')
      670 |           .send({ format: 'complete' })
    > 671 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      672 |
      673 |         // TODO: Once endpoint is implemented, verify:
      674 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:671:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=complete and return 48 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=summary and return 7 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=layer1 and return 15 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=layer2 and return 20 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 7: All format options work ‚Ä∫ should export with format=layer3 and return 25 columns

    expected 404 "Not Found", got 500 "Internal Server Error"

      691 |             .post('/jobs/' + jobId + '/export')
      692 |             .send({ format })
    > 693 |             .expect(HttpStatus.NOT_FOUND);
          |              ^
      694 |
      695 |           // TODO: Once endpoint is implemented, verify:
      696 |           // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:693:14)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should handle filter=all (no filtering)

    expected 404 "Not Found", got 500 "Internal Server Error"

      710 |             filter: 'all',
      711 |           })
    > 712 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      713 |
      714 |         // TODO: Once endpoint is implemented, verify:
      715 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:712:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should handle layer=all (no layer filtering)

    expected 404 "Not Found", got 500 "Internal Server Error"

      725 |             layer: 'all',
      726 |           })
    > 727 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      728 |
      729 |         // TODO: Once endpoint is implemented, verify:
      730 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:727:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should handle confidence=all (no confidence filtering)

    expected 404 "Not Found", got 500 "Internal Server Error"

      740 |             confidence: 'all',
      741 |           })
    > 742 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      743 |
      744 |         // TODO: Once endpoint is implemented, verify:
      745 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:742:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should handle multiple valid filters simultaneously

    expected 404 "Not Found", got 500 "Internal Server Error"

      757 |             confidence: 'medium',
      758 |           })
    > 759 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      760 |
      761 |         // TODO: Once endpoint is implemented, verify:
      762 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:759:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should return 400 for invalid filter value

    expected 404 "Not Found", got 500 "Internal Server Error"

      775 |             filter: 'invalid_filter',
      776 |           })
    > 777 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      778 |
      779 |         // TODO: Once endpoint is implemented, verify:
      780 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:777:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should return 400 for invalid layer value

    expected 404 "Not Found", got 500 "Internal Server Error"

      790 |             layer: 'invalid_layer',
      791 |           })
    > 792 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      793 |
      794 |         // TODO: Once endpoint is implemented, verify:
      795 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:792:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Scenario 8: Filter combinations work ‚Ä∫ should return 400 for invalid confidence value

    expected 404 "Not Found", got 500 "Internal Server Error"

      805 |             confidence: 'invalid_confidence',
      806 |           })
    > 807 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      808 |
      809 |         // TODO: Once endpoint is implemented, verify:
      810 |         // - Status: 400 Bad Request

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:807:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should handle empty result set gracefully

    expected 404 "Not Found", got 500 "Internal Server Error"

      819 |           .post('/jobs/' + jobId + '/export')
      820 |           .send({ format: 'complete' })
    > 821 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      822 |
      823 |         // TODO: Once endpoint is implemented, verify:
      824 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:821:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should handle large result sets without timeout

    expected 404 "Not Found", got 500 "Internal Server Error"

      831 |           .post('/jobs/' + jobId + '/export')
      832 |           .send({ format: 'complete' })
    > 833 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      834 |
      835 |         // TODO: Once endpoint is implemented, verify:
      836 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:833:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should handle NULL factor values in export

    expected 404 "Not Found", got 500 "Internal Server Error"

      843 |           .post('/jobs/' + jobId + '/export')
      844 |           .send({ format: 'complete' })
    > 845 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      846 |
      847 |         // TODO: Once endpoint is implemented, verify:
      848 |         // - Status: 200 OK

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:845:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should validate request body schema

    expected 404 "Not Found", got 500 "Internal Server Error"

      858 |             unknown_field: 'should_be_rejected',
      859 |           })
    > 860 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      861 |
      862 |         // TODO: Once endpoint is implemented, verify:
      863 |         // - Status: 400 Bad Request (if forbidNonWhitelisted is true)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:860:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Edge Cases and Error Handling ‚Ä∫ should handle concurrent export requests

    expected 404 "Not Found", got 500 "Internal Server Error"

      874 |
      875 |         await Promise.all(
    > 876 |           requests.map(req => req.expect(HttpStatus.NOT_FOUND))
          |                                   ^
      877 |         );
      878 |
      879 |         // TODO: Once endpoint is implemented, verify:

      at src/jobs/__tests__/jobs.controller.spec.ts:876:35
          at Array.map (<anonymous>)
      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:876:20)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at ../../node_modules/supertest/lib/test.js:156:7
      at Test.fn [as callback] (../../node_modules/superagent/src/node/index.js:904:3)
      at callback (../../node_modules/superagent/src/node/index.js:1183:18)
      at IncomingMessage.fn (../../node_modules/superagent/src/node/parsers/json.js:19:7)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Streaming and Performance Requirements ‚Ä∫ should use streaming response (not buffer entire file)

    expected 404 "Not Found", got 500 "Internal Server Error"

      889 |           .post('/jobs/' + jobId + '/export')
      890 |           .send({ format: 'complete' })
    > 891 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      892 |
      893 |         // TODO: Once endpoint is implemented, verify:
      894 |         // - Response uses streaming (check Transfer-Encoding or similar)

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:891:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Streaming and Performance Requirements ‚Ä∫ should call ExportService.streamCSVExport()

    expected 404 "Not Found", got 500 "Internal Server Error"

      901 |           .post('/jobs/' + jobId + '/export')
      902 |           .send({ format: 'complete' })
    > 903 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      904 |
      905 |         // TODO: Once endpoint is implemented, verify:
      906 |         // - JobsController calls ExportService.streamCSVExport()

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:903:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

  ‚óè JobsController - POST /jobs/:jobId/export (T056) ‚Ä∫ POST /jobs/:jobId/export ‚Ä∫ Streaming and Performance Requirements ‚Ä∫ should complete export of 10k rows in < 5 seconds

    expected 404 "Not Found", got 500 "Internal Server Error"

      915 |           .post('/jobs/' + jobId + '/export')
      916 |           .send({ format: 'complete' })
    > 917 |           .expect(HttpStatus.NOT_FOUND);
          |            ^
      918 |
      919 |         const elapsedTime = Date.now() - startTime;
      920 |

      at Object.<anonymous> (src/jobs/__tests__/jobs.controller.spec.ts:917:12)
      ----
      at Test._assertStatus (../../node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/supertest/lib/test.js:152:11)

FAIL src/queue/__tests__/layer-factors.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer1-domain-analysis.service.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m8[0m   Layer1Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/services/__tests__/product-offering-detector.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/queue/__tests__/layer2-processor.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/services/__tests__/monetization-detector.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/__tests__/llm.service.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/llm.service.ts[0m:[93m4[0m:[93m52[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer3Results'. Did you mean 'Layer3Rules'?

    [7m4[0m import type { LlmProvider, ClassificationResponse, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                                                   ~~~~~~~~~~~~~[0m

FAIL src/jobs/__tests__/confidence-scoring.service.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/__tests__/confidence-scoring.service.spec.ts[0m:[93m54[0m:[93m5[0m - [91merror[0m[90m TS2353: [0mObject literal may only specify known properties, and 'queue_size_limit' does not exist in type 'ManualReviewSettings'.

    [7m54[0m     queue_size_limit: null,
    [7m  [0m [91m    ~~~~~~~~~~~~~~~~[0m

      [96m../../packages/shared/src/types/settings.ts[0m:[93m124[0m:[93m3[0m
        [7m124[0m   manual_review_settings: ManualReviewSettings;
        [7m   [0m [96m  ~~~~~~~~~~~~~~~~~~~~~~[0m
        The expected type comes from property 'manual_review_settings' which is declared here on type 'ClassificationSettings'

FAIL src/jobs/services/__tests__/navigation-parser.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/services/__tests__/layout-analyzer.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer2-operational-filter.service.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m9[0m   Layer2Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/queue/__tests__/layer1-processor.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer1-domain-analysis.service.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m8[0m   Layer1Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/jobs/services/__tests__/routing-activity-logs.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/__tests__/routing-activity-logs.spec.ts[0m:[93m2[0m:[93m43[0m - [91merror[0m[90m TS2307: [0mCannot find module '../manual-review-router.service' or its corresponding type declarations.

    [7m2[0m import { ManualReviewRouterService } from '../manual-review-router.service';
    [7m [0m [91m                                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/routing-activity-logs.spec.ts[0m:[93m5[0m:[93m15[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m              ~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/routing-activity-logs.spec.ts[0m:[93m5[0m:[93m30[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                             ~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/routing-activity-logs.spec.ts[0m:[93m5[0m:[93m45[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer3Results'. Did you mean 'Layer3Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                                            ~~~~~~~~~~~~~[0m

FAIL src/workers/__tests__/url-worker.processor.spec.ts
  ‚óè Test suite failed to run

    [96msrc/workers/__tests__/url-worker.processor.spec.ts[0m:[93m9[0m:[93m43[0m - [91merror[0m[90m TS2307: [0mCannot find module '../../jobs/services/manual-review-router.service' or its corresponding type declarations.

    [7m9[0m import { ManualReviewRouterService } from '../../jobs/services/manual-review-router.service';
    [7m [0m [91m                                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m

FAIL src/queue/__tests__/queue.service-process-url-integration.spec.ts
  ‚óè Test suite failed to run

    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m243[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: true; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: true; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m243[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m244[0m       passed: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m246[0m       processingTimeMs: 50,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m247[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m252[0m:[93m51[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ success: true; content: string; title: string; }' is not assignable to parameter of type 'ScraperResult | Promise<ScraperResult>'.
      Type '{ success: true; content: string; title: string; }' is missing the following properties from type 'ScraperResult': url, metaDescription

    [7m252[0m     mockScraperService.fetchUrl.mockResolvedValue({
    [7m   [0m [91m                                                  ~[0m
    [7m253[0m       success: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m255[0m       title: 'Enterprise Software Solution',
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m256[0m     });
    [7m   [0m [91m~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m262[0m:[93m7[0m - [91merror[0m[90m TS2740: [0mType '{}' is missing the following properties from type 'Layer2Signals': has_product_offering, product_confidence, detected_product_keywords, homepage_is_blog, and 10 more.

    [7m262[0m       signals: {},
    [7m   [0m [91m      ~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m272[0m:[93m7[0m - [91merror[0m[90m TS2322: [0mType '"openai"' is not assignable to type 'LlmProvider'.

    [7m272[0m       provider: 'openai',
    [7m   [0m [91m      ~~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m401[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: false; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: false; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m401[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m402[0m       passed: false,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m404[0m       processingTimeMs: 30,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m405[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m473[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: true; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: true; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m473[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m474[0m       passed: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m476[0m       processingTimeMs: 40,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m477[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m481[0m:[93m51[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ success: true; content: string; title: string; }' is not assignable to parameter of type 'ScraperResult | Promise<ScraperResult>'.
      Type '{ success: true; content: string; title: string; }' is missing the following properties from type 'ScraperResult': url, metaDescription

    [7m481[0m     mockScraperService.fetchUrl.mockResolvedValue({
    [7m   [0m [91m                                                  ~[0m
    [7m482[0m       success: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m484[0m       title: 'My Personal Blog',
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m485[0m     });
    [7m   [0m [91m~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m491[0m:[93m7[0m - [91merror[0m[90m TS2740: [0mType '{}' is missing the following properties from type 'Layer2Signals': has_product_offering, product_confidence, detected_product_keywords, homepage_is_blog, and 10 more.

    [7m491[0m       signals: {},
    [7m   [0m [91m      ~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m575[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: true; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: true; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m575[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m576[0m       passed: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m578[0m       processingTimeMs: 45,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m579[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m583[0m:[93m51[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ success: true; content: string; title: string; }' is not assignable to parameter of type 'ScraperResult | Promise<ScraperResult>'.
      Type '{ success: true; content: string; title: string; }' is missing the following properties from type 'ScraperResult': url, metaDescription

    [7m583[0m     mockScraperService.fetchUrl.mockResolvedValue({
    [7m   [0m [91m                                                  ~[0m
    [7m584[0m       success: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m586[0m       title: 'Generic Store',
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m587[0m     });
    [7m   [0m [91m~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m592[0m:[93m7[0m - [91merror[0m[90m TS2740: [0mType '{}' is missing the following properties from type 'Layer2Signals': has_product_offering, product_confidence, detected_product_keywords, homepage_is_blog, and 10 more.

    [7m592[0m       signals: {},
    [7m   [0m [91m      ~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m602[0m:[93m7[0m - [91merror[0m[90m TS2322: [0mType '"openai"' is not assignable to type 'LlmProvider'.

    [7m602[0m       provider: 'openai',
    [7m   [0m [91m      ~~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m657[0m:[93m50[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ passed: true; reasoning: string; processingTimeMs: number; }' is not assignable to parameter of type 'Layer1AnalysisResult'.
      Property 'layer' is missing in type '{ passed: true; reasoning: string; processingTimeMs: number; }' but required in type 'Layer1AnalysisResult'.

    [7m657[0m     mockLayer1Service.analyzeUrl.mockReturnValue({
    [7m   [0m [91m                                                 ~[0m
    [7m658[0m       passed: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m660[0m       processingTimeMs: 40,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m661[0m     });
    [7m   [0m [91m~~~~~[0m

      [96m../../packages/shared/src/types/layer1.ts[0m:[93m16[0m:[93m3[0m
        [7m16[0m   layer: 'layer1';
        [7m  [0m [96m  ~~~~~[0m
        'layer' is declared here.
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m681[0m:[93m51[0m - [91merror[0m[90m TS2345: [0mArgument of type '{ success: true; content: string; title: string; }' is not assignable to parameter of type 'ScraperResult | Promise<ScraperResult>'.
      Type '{ success: true; content: string; title: string; }' is missing the following properties from type 'ScraperResult': url, metaDescription

    [7m681[0m     mockScraperService.fetchUrl.mockResolvedValue({
    [7m   [0m [91m                                                  ~[0m
    [7m682[0m       success: true,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m684[0m       title: 'Site Title',
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m685[0m     });
    [7m   [0m [91m~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m690[0m:[93m7[0m - [91merror[0m[90m TS2740: [0mType '{}' is missing the following properties from type 'Layer2Signals': has_product_offering, product_confidence, detected_product_keywords, homepage_is_blog, and 10 more.

    [7m690[0m       signals: {},
    [7m   [0m [91m      ~~~~~~~[0m
    [96msrc/queue/__tests__/queue.service-process-url-integration.spec.ts[0m:[93m736[0m:[93m7[0m - [91merror[0m[90m TS2322: [0mType '"openai"' is not assignable to type 'LlmProvider'.

    [7m736[0m       provider: 'openai',
    [7m   [0m [91m      ~~~~~~~~[0m

FAIL src/jobs/services/__tests__/confidence-routing-accuracy.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/__tests__/confidence-routing-accuracy.spec.ts[0m:[93m2[0m:[93m43[0m - [91merror[0m[90m TS2307: [0mCannot find module '../manual-review-router.service' or its corresponding type declarations.

    [7m2[0m import { ManualReviewRouterService } from '../manual-review-router.service';
    [7m [0m [91m                                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/confidence-routing-accuracy.spec.ts[0m:[93m5[0m:[93m15[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m              ~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/confidence-routing-accuracy.spec.ts[0m:[93m5[0m:[93m30[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer2Results'. Did you mean 'Layer2Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                             ~~~~~~~~~~~~~[0m
    [96msrc/jobs/services/__tests__/confidence-routing-accuracy.spec.ts[0m:[93m5[0m:[93m45[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer3Results'. Did you mean 'Layer3Rules'?

    [7m5[0m import type { Layer1Results, Layer2Results, Layer3Results } from '@website-scraper/shared';
    [7m [0m [91m                                            ~~~~~~~~~~~~~[0m

FAIL src/settings/__tests__/settings-integration.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer1-domain-analysis.service.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m8[0m   Layer1Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m

FAIL src/__tests__/integration/open-access.spec.ts
  ‚óè Test suite failed to run

    [96msrc/jobs/services/layer1-domain-analysis.service.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"@website-scraper/shared"' has no exported member named 'Layer1Results'. Did you mean 'Layer1Rules'?

    [7m8[0m   Layer1Results,
    [7m [0m [91m  ~~~~~~~~~~~~~[0m


Test Suites: 21 failed, 1 skipped, 15 passed, 36 of 37 total
Tests:       85 failed, 5 skipped, 367 passed, 457 total
Snapshots:   0 total
Time:        15.917 s, estimated 37 s
Ran all test suites.
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api
npm error workspace @website-scraper/api@0.1.0
npm error location /Users/s0mebody/Desktop/dev/projects/website-scraper-project/apps/api
npm error command failed
npm error command sh -c jest
