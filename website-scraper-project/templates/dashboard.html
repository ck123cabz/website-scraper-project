<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Dashboard</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);

            socket.on('connect', function() {
                console.log('Websocket connected!');
            });

            socket.on('task_update', function(data) {
                const tasksContainer = document.getElementById('tasks');
                let taskRow = document.getElementById('task-' + data.id);
                if (!taskRow) {
                    taskRow = document.createElement('tr');
                    taskRow.id = 'task-' + data.id;
                    taskRow.innerHTML = `
                        <td>${data.id}</td>
                        <td id="status-${data.id}"></td>
                        <td id="progress-${data.id}"></td>
                        <td id="actions-${data.id}"></td>
                    `;
                    tasksContainer.appendChild(taskRow);
                }
                document.getElementById('status-' + data.id).textContent = data.status;
                document.getElementById('progress-' + data.id).textContent = data.progress + '%';
                if (data.status === 'Completed') {
                    document.getElementById('actions-' + data.id).innerHTML = '<button>Download</button>';
                }
            });

            socket.on('disconnect', function() {
                console.log('Disconnected from server.');
            });
        });
    </script>
</head>
<body>
    <table id="tasks">
        <tr>
            <th>Task ID</th>
            <th>Status</th>
            <th>Progress</th>
            <th>Actions</th>
        </tr>
    </table>
</body>
</html>
